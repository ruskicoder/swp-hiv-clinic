import{u as H,r as n,j as e,c as S,d as I}from"./index-ottAEAuo.js";import{B}from"./BackNavigation-HgcMJe-S.js";import{S as m}from"./SafeComponents-D2JEnfCK.js";const K=()=>{const{user:o,updateUser:C}=H(),[j,v]=n.useState("profile"),[a,t]=n.useState(!1),[u,h]=n.useState(""),[f,i]=n.useState(""),[d,k]=n.useState(!1),[A,D]=n.useState(!1),[l,y]=n.useState({firstName:"",lastName:"",phoneNumber:"",email:"",dateOfBirth:"",address:"",bio:"",profileImageBase64:""}),[p,F]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[N,L]=n.useState({emailAppointments:!0,smsReminders:!1,marketingCommunications:!1});n.useEffect(()=>{(async()=>{if(o)try{t(!0);const s=await S.getUserProfile();s&&y({firstName:s.firstName||"",lastName:s.lastName||"",phoneNumber:s.phoneNumber||"",email:s.email||o.email||"",dateOfBirth:s.dateOfBirth||"",address:s.address||"",bio:s.bio||"",profileImageBase64:s.profileImageBase64||""})}catch(s){console.error("Error loading user profile:",s),i("Failed to load profile data")}finally{t(!1),D(!0)}})()},[o]),n.useEffect(()=>{if(u||f){const r=setTimeout(()=>{h(""),i("")},5e3);return()=>clearTimeout(r)}},[u,f]),n.useEffect(()=>(document.body.style.display="none",document.body.offsetHeight,document.body.style.display="",()=>{document.body.style.display=""}),[]),n.useEffect(()=>(document.documentElement.style.visibility=a?"hidden":"visible",()=>{document.documentElement.style.visibility="visible"}),[a]);const g=r=>{const{name:s,value:c}=r.target;y(x=>({...x,[s]:c}))},w=r=>{const{name:s,value:c}=r.target;F(x=>({...x,[s]:c}))},P=r=>{const{name:s,checked:c}=r.target;L(x=>({...x,[s]:c}))},O=async r=>{r.preventDefault(),t(!0),i(""),h("");try{const s=await S.updateProfile(l);s.success?(h("Profile updated successfully!"),k(!1),C&&C({...o,firstName:l.firstName,lastName:l.lastName})):i(s.message||"Failed to update profile")}catch(s){console.error("Error updating profile:",s),i("Failed to update profile. Please try again.")}finally{t(!1)}},R=async r=>{if(r.preventDefault(),t(!0),i(""),h(""),p.newPassword.length<6){i("New password must be at least 6 characters long"),t(!1);return}if(p.newPassword!==p.confirmPassword){i("New passwords do not match"),t(!1);return}try{const s=await I.put("/auth/change-password",{currentPassword:p.currentPassword,newPassword:p.newPassword});s.data.success?(h("Password changed successfully!"),F({currentPassword:"",newPassword:"",confirmPassword:""})):i(s.data.message||"Failed to change password")}catch(s){console.error("Error changing password:",s),i("Failed to change password. Please check your current password.")}finally{t(!1)}},T=async r=>{r.preventDefault(),t(!0),i(""),h("");try{(await I.put("/auth/notifications",N)).data.success?h("Notification preferences updated successfully!"):i("Failed to update notification preferences")}catch(s){console.error("Error updating notifications:",s),i("Failed to update notification preferences. Please try again.")}finally{t(!1)}},U=async r=>{const s=r.target.files[0];if(s){if(!s.type.startsWith("image/")){i("Please select a valid image file");return}if(s.size>5*1024*1024){i("Image size must be less than 5MB");return}t(!0),i("");try{const c=new FileReader;c.onload=async x=>{const E=x.target.result;try{const b=await S.updateProfileImage(E);b.success?(y($=>({...$,profileImageBase64:E})),h("Profile image updated successfully!")):i(b.message||"Failed to update profile image")}catch(b){console.error("Error updating profile image:",b),i("Failed to update profile image. Please try again.")}finally{t(!1)}},c.readAsDataURL(s)}catch(c){console.error("Error reading file:",c),i("Failed to read image file"),t(!1)}}},q=()=>e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Profile Information"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>k(!d),disabled:a,children:d?"Cancel":"Edit Profile"})]}),u&&e.jsx("div",{className:"success-message",children:e.jsx(m,{children:u})}),f&&e.jsx("div",{className:"error-message",children:e.jsx(m,{children:f})}),e.jsxs("form",{onSubmit:O,className:"settings-form",children:[e.jsxs("div",{className:"form-group profile-image-group",children:[e.jsx("label",{children:"Profile Picture"}),e.jsxs("div",{className:"profile-image-section",children:[e.jsx("div",{className:"profile-image-container",children:l.profileImageBase64?e.jsx("img",{src:l.profileImageBase64,alt:"Profile",className:"profile-image-preview"}):e.jsx("div",{className:"profile-image-placeholder",children:e.jsx("span",{children:"No Image"})})}),e.jsxs("div",{className:"image-upload-controls",children:[e.jsx("input",{type:"file",id:"profileImageInput",accept:"image/*",onChange:U,disabled:a,className:"profile-image-input",style:{display:"none"}}),e.jsx("label",{htmlFor:"profileImageInput",className:"upload-btn",style:{opacity:a?.6:1,pointerEvents:a?"none":"auto"},children:a?"Uploading...":"Change Photo"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{type:"text",id:"firstName",name:"firstName",value:l.firstName,onChange:g,disabled:!d||a,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",value:l.lastName,onChange:g,disabled:!d||a,required:!0})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:l.email,onChange:g,disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",value:l.phoneNumber,onChange:g,disabled:!d||a})]})]}),o?.role==="Patient"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"dateOfBirth",children:"Date of Birth"}),e.jsx("input",{type:"date",id:"dateOfBirth",name:"dateOfBirth",value:l.dateOfBirth,onChange:g,disabled:!d||a})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("textarea",{id:"address",name:"address",value:l.address,onChange:g,disabled:!d||a,rows:"3",placeholder:"Enter your address..."})]})]}),o?.role==="Doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",name:"bio",value:l.bio,onChange:g,disabled:!d||a,rows:"4",placeholder:"Tell us about yourself..."})]}),d&&e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a,children:a?"Saving...":"Save Changes"})})]})]}),M=()=>e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Security Settings"}),u&&e.jsx("div",{className:"success-message",children:e.jsx(m,{children:u})}),f&&e.jsx("div",{className:"error-message",children:e.jsx(m,{children:f})}),e.jsxs("form",{onSubmit:R,className:"settings-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",name:"currentPassword",value:p.currentPassword,onChange:w,disabled:a,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",name:"newPassword",value:p.newPassword,onChange:w,disabled:a,required:!0,minLength:"6"}),e.jsx("small",{className:"form-help",children:"Password must be at least 6 characters"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:p.confirmPassword,onChange:w,disabled:a,required:!0})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a,children:a?"Changing...":"Change Password"})})]}),e.jsxs("div",{className:"security-info",children:[e.jsx("h4",{children:"Security Information"}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Last Login:"})," ",e.jsx(m,{children:o?.lastLogin||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Account Created:"})," ",e.jsx(m,{children:o?.createdAt||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Account Status:"}),e.jsx("span",{className:`status-badge ${o?.isActive?"active":"inactive"}`,children:e.jsx(m,{children:o?.isActive?"Active":"Inactive"})})]})]})]}),z=()=>e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Notification Preferences"}),u&&e.jsx("div",{className:"success-message",children:e.jsx(m,{children:u})}),f&&e.jsx("div",{className:"error-message",children:e.jsx(m,{children:f})}),e.jsxs("form",{onSubmit:T,className:"settings-form",children:[e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"emailAppointments",checked:N.emailAppointments,onChange:P,disabled:a}),e.jsx("span",{className:"checkbox-text",children:"Email notifications for appointments"})]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"smsReminders",checked:N.smsReminders,onChange:P,disabled:a}),e.jsx("span",{className:"checkbox-text",children:"SMS reminders"})]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"marketingCommunications",checked:N.marketingCommunications,onChange:P,disabled:a}),e.jsx("span",{className:"checkbox-text",children:"Marketing communications"})]})}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a,children:a?"Saving...":"Save Preferences"})})]})]});return A?e.jsxs("div",{className:"settings-container",children:[e.jsx(B,{}),e.jsxs("div",{className:"settings-header",children:[e.jsx("h1",{children:"Settings"}),e.jsx("p",{children:"Manage your account preferences"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsx("div",{className:"settings-sidebar",children:e.jsxs("nav",{className:"settings-nav",children:[e.jsx("button",{className:`nav-button ${j==="profile"?"active":""}`,onClick:()=>v("profile"),children:"👤 Profile"}),e.jsx("button",{className:`nav-button ${j==="security"?"active":""}`,onClick:()=>v("security"),children:"🔒 Security"}),e.jsx("button",{className:`nav-button ${j==="notifications"?"active":""}`,onClick:()=>v("notifications"),children:"🔔 Notifications"})]})}),e.jsxs("div",{className:"settings-main",children:[j==="profile"&&q(),j==="security"&&M(),j==="notifications"&&z()]})]})]}):e.jsxs("div",{className:"settings-container",children:[e.jsx(B,{}),e.jsxs("div",{className:"settings-header",children:[e.jsx("h1",{children:"Settings"}),e.jsx("p",{children:"Loading your preferences..."})]}),e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading settings..."})]})]})};export{K as default};
