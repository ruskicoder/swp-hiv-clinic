import{u as K,a as Q,r as t,d as c,j as e,E as j}from"./index-CScRpsKl.js";import{D as W}from"./DashboardHeader-BQ5_pi8w.js";import{s as r,a as R,c as X}from"./renderUtils-HeC9N5td.js";import"./UserProfileDropdown-Cd9gt73g.js";const te=()=>{const{user:Y,logout:Z}=K();Q();const[u,y]=t.useState("overview"),[P,w]=t.useState(!0),[A,v]=t.useState(""),[N,T]=t.useState([]),[U,I]=t.useState([]),[b,L]=t.useState([]),[g,$]=t.useState([]),[q,M]=t.useState([]),[D,C]=t.useState(""),[S,F]=t.useState("");t.useEffect(()=>{o()},[]);const o=async()=>{w(!0),v(""),C(""),F("");try{console.log("Loading admin dashboard data...");const[s,a,i,h,m]=await Promise.allSettled([c.get("/admin/users"),c.get("/admin/patients"),c.get("/admin/doctors"),c.get("/admin/appointments"),c.get("/admin/specialties")]);s.status==="fulfilled"&&s.value?.data?T(Array.isArray(s.value.data)?s.value.data:[]):C("Failed to load users"),a.status==="fulfilled"&&a.value?.data&&I(Array.isArray(a.value.data)?a.value.data:[]),i.status==="fulfilled"&&i.value?.data&&L(Array.isArray(i.value.data)?i.value.data:[]),h.status==="fulfilled"&&h.value?.data?$(Array.isArray(h.value.data)?h.value.data:[]):F("Failed to load appointments"),m.status==="fulfilled"&&m.value?.data&&M(Array.isArray(m.value.data)?m.value.data:[])}catch(s){console.error("Dashboard error:",s),v("Failed to load dashboard data. Please try again.")}finally{w(!1)}},E=async s=>{try{await c.put(`/admin/users/${s}/toggle-status`),o()}catch(a){console.error("Toggle user status error:",a),v("Failed to toggle user status")}},k=async s=>{const a=prompt("Enter new password:");if(a)try{await c.put(`/admin/users/${s}/reset-password`,null,{params:{newPassword:a}}),alert("Password reset successfully")}catch(i){console.error("Reset password error:",i),v("Failed to reset password")}},O=[{id:"overview",label:"Overview",icon:"ðŸ“Š"},{id:"users",label:"Manage Users",icon:"ðŸ‘¥"},{id:"doctors",label:"Manage Doctors",icon:"ðŸ‘¨â€âš•ï¸"},{id:"appointments",label:"All Appointments",icon:"ðŸ“…"},{id:"create-doctor",label:"Create Doctor",icon:"âž•"}],V=()=>e.jsx(j,{children:e.jsxs("div",{className:"overview-section",children:[e.jsx("div",{className:"content-header",children:e.jsx("h2",{children:"Admin Dashboard"})}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Users"}),e.jsx("p",{className:"stat-number",children:N?.length||0})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Patients"}),e.jsx("p",{className:"stat-number",children:U?.length||0})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Doctors"}),e.jsx("p",{className:"stat-number",children:b?.length||0})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Appointments"}),e.jsx("p",{className:"stat-number",children:g?.length||0})]})]}),A&&e.jsxs("div",{className:"error-message",children:[A,e.jsx("button",{onClick:o,className:"retry-btn",children:"Retry"})]})]})}),B=()=>e.jsx(j,{children:e.jsxs("div",{className:"users-section",children:[e.jsxs("div",{className:"content-header",children:[e.jsx("h2",{children:"Manage Users"}),e.jsx("p",{children:"View and manage all system users"})]}),D&&e.jsx("div",{className:"error-message",children:D}),!N||N.length===0?e.jsxs("div",{className:"no-data",children:[e.jsx("p",{children:"No users found."}),e.jsx("button",{className:"refresh-btn",onClick:o,children:"Refresh"})]}):e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:N.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:r(s?.username)}),e.jsx("td",{children:r(s?.email)}),e.jsx("td",{children:r(s?.role?.roleName||s?.role)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${s?.isActive?"active":"inactive"}`,children:s?.isActive?"Active":"Inactive"})}),e.jsx("td",{children:R(s?.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-toggle",onClick:()=>E(s?.userId),children:s?.isActive?"Deactivate":"Activate"}),e.jsx("button",{className:"btn-reset",onClick:()=>k(s?.userId),children:"Reset Password"})]})})]},s?.userId||a))})]})})]})}),H=()=>e.jsx(j,{children:e.jsxs("div",{className:"doctors-section",children:[e.jsxs("div",{className:"content-header",children:[e.jsx("h2",{children:"Manage Doctors"}),e.jsx("p",{children:"View and manage doctor accounts"})]}),!b||b.length===0?e.jsxs("div",{className:"no-data",children:[e.jsx("p",{children:"No doctors found."}),e.jsx("button",{className:"refresh-btn",onClick:o,children:"Refresh"})]}):e.jsx("div",{className:"doctors-grid",children:b.map((s,a)=>e.jsx(j,{children:e.jsxs("div",{className:"doctor-card",children:[e.jsxs("h4",{children:["Dr. ",r(s?.username)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",r(s?.email)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`status-badge ${s?.isActive?"active":"inactive"}`,children:s?.isActive?"Active":"Inactive"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",R(s?.createdAt)]}),e.jsx("div",{className:"doctor-actions",children:e.jsx("button",{className:"btn-toggle",onClick:()=>E(s?.userId),children:s?.isActive?"Deactivate":"Activate"})})]})},s?.userId||a))})]})}),z=()=>e.jsx(j,{children:e.jsxs("div",{className:"appointments-section",children:[e.jsxs("div",{className:"content-header",children:[e.jsx("h2",{children:"All Appointments"}),e.jsx("p",{children:"View all system appointments"})]}),S&&e.jsx("div",{className:"error-message",children:S}),!g||g.length===0?e.jsxs("div",{className:"no-data",children:[e.jsx("p",{children:"No appointments found."}),e.jsx("button",{className:"refresh-btn",onClick:o,children:"Refresh"})]}):e.jsx("div",{className:"appointments-table-container",children:e.jsxs("table",{className:"appointments-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Doctor"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:g.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:r(s?.patientUser?.username)}),e.jsxs("td",{children:["Dr. ",r(s?.doctorUser?.username)]}),e.jsx("td",{children:X(s?.appointmentDateTime)}),e.jsxs("td",{children:[r(s?.durationMinutes)," min"]}),e.jsx("td",{children:e.jsx("span",{className:`status ${r(s?.status).toLowerCase()}`,children:r(s?.status)})}),e.jsx("td",{children:r(s?.appointmentNotes)})]},s?.appointmentId||a))})]})})]})}),G=()=>{const[s,a]=t.useState({username:"",email:"",password:"",firstName:"",lastName:"",phoneNumber:"",specialtyId:"",bio:""}),[i,h]=t.useState(!1),[m,f]=t.useState(""),J=async d=>{d.preventDefault(),h(!0),f("");try{const n=new URLSearchParams;Object.keys(s).forEach(x=>{x==="specialtyId"&&s[x]?n.append(x,Number(s[x])):n.append(x,s[x]??"")});const p=await c.post("/admin/doctors",n,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});p.data&&(p.data.success||p.data.isSuccess)?(alert("Doctor created successfully!"),a({username:"",email:"",password:"",firstName:"",lastName:"",phoneNumber:"",specialtyId:"",bio:""}),o(),y("doctors")):f(p.data?.message||p.data?.msg||"Failed to create doctor")}catch(n){f(n?.response?.data?.message||n?.response?.data?.msg||n?.response?.data?.error||n?.message||"Failed to create doctor")}finally{h(!1)}},l=d=>{a({...s,[d.target.name]:d.target.value})};return e.jsx(j,{children:e.jsxs("div",{className:"create-doctor-section",children:[e.jsxs("div",{className:"content-header",children:[e.jsx("h2",{children:"Create Doctor Account"}),e.jsx("p",{children:"Add a new doctor to the system"})]}),e.jsxs("form",{onSubmit:J,className:"create-doctor-form",children:[m&&e.jsx("div",{className:"error-message",children:m}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:l,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{type:"text",id:"firstName",name:"firstName",value:s.firstName,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",value:s.lastName,onChange:l,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",value:s.phoneNumber,onChange:l})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"specialtyId",children:"Specialty"}),e.jsxs("select",{id:"specialtyId",name:"specialtyId",value:s.specialtyId,onChange:l,children:[e.jsx("option",{value:"",children:"Select a specialty..."}),q.map((d,n)=>e.jsx("option",{value:d?.specialtyId,children:r(d?.specialtyName)},d?.specialtyId||n))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"bio",children:"Biography"}),e.jsx("textarea",{id:"bio",name:"bio",value:s.bio,onChange:l,placeholder:"Enter doctor's biography...",rows:"4"})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:i,children:i?"Creating...":"Create Doctor"})]})]})})};return P?e.jsx("div",{className:"admin-dashboard",children:e.jsx("div",{className:"loading",children:"Loading dashboard data..."})}):e.jsxs("div",{className:"admin-dashboard",children:[e.jsx(W,{title:"Admin Dashboard",subtitle:"System overview and management"}),e.jsxs("div",{className:"dashboard-layout",children:[e.jsx("aside",{className:"manager-sidebar",children:O.map(s=>e.jsxs("button",{className:`sidebar-option${u===s.id?" active":""}`,onClick:()=>y(s.id),children:[s.icon," ",s.label]},s.id))}),e.jsxs("main",{className:"dashboard-main",children:[u==="overview"&&V(),u==="users"&&B(),u==="doctors"&&H(),u==="appointments"&&z(),u==="create-doctor"&&e.jsx(G,{})]})]})]})};export{te as default};
