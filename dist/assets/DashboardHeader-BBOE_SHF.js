import{j as e,g as H,r as m,u as G,n as M,d as $}from"./index-ottAEAuo.js";import{U as _}from"./UserProfileDropdown-Cl9Ss_zV.js";const W=({count:a,onClick:x})=>e.jsxs("div",{className:"notification-icon",onClick:x,children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),a>0&&e.jsx("span",{className:"badge",children:a})]});var D={exports:{}},C,O;function B(){if(O)return C;O=1;var a="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return C=a,C}var A,F;function V(){if(F)return A;F=1;var a=B();function x(){}function l(){}return l.resetWarningCache=x,A=function(){function t(y,b,f,v,u,s){if(s!==a){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}t.isRequired=t;function p(){return t}var c={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:p,element:t,elementType:t,instanceOf:p,node:t,objectOf:p,oneOf:p,oneOfType:p,shape:p,exact:p,checkPropTypes:l,resetWarningCache:x};return c.PropTypes=c,c},A}var q;function z(){return q||(q=1,D.exports=V()()),D.exports}var J=z();const n=H(J),U=({notification:a,onMarkAsRead:x,enhanced:l=!1})=>{const{notificationId:t,title:p,message:c,isRead:y,createdAt:b,priority:f,type:v}=a,[u,s]=m.useState(!1),r=h=>{const w=Math.floor((new Date-new Date(h))/1e3);let o=w/31536e3;return o>1?Math.floor(o)+" year"+(Math.floor(o)!==1?"s":"")+" ago":(o=w/2592e3,o>1?Math.floor(o)+" month"+(Math.floor(o)!==1?"s":"")+" ago":(o=w/86400,o>1?Math.floor(o)+" day"+(Math.floor(o)!==1?"s":"")+" ago":(o=w/3600,o>1?Math.floor(o)+" hour"+(Math.floor(o)!==1?"s":"")+" ago":(o=w/60,o>1?Math.floor(o)+" minute"+(Math.floor(o)!==1?"s":"")+" ago":"Just now"))))},j=h=>({APPOINTMENT_REMINDER:"📅",MEDICATION_REMINDER:"💊",FOLLOW_UP:"🔄",GENERAL:"📢",EMERGENCY:"🚨",EDUCATIONAL:"📚",SYSTEM:"⚙️"})[h]||"📨",R=h=>({URGENT:{class:"urgent",icon:"🔴",text:"Urgent"},HIGH:{class:"high",icon:"🟡",text:"High"},MEDIUM:{class:"medium",icon:"🔵",text:"Medium"},LOW:{class:"low",icon:"⚪",text:"Low"}})[h]||{class:"medium",icon:"🔵",text:"Medium"},S=h=>{h.stopPropagation(),!y&&x&&(console.log("Marking notification as read:",t),x(t))},T=h=>{h.stopPropagation(),s(!u)},N=R(f),I=j(v),P=c&&c.length>120,k=P&&!u?`${c.substring(0,120)}...`:c;return e.jsxs("div",{className:`notification-item ${y?"read":"unread"} ${l?"enhanced":""} priority-${N.class}`,onClick:S,role:"button",tabIndex:0,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),S(h))},"aria-label":`Notification: ${p}. ${y?"Read":"Unread"}. Priority: ${N.text}`,children:[!y&&e.jsx("div",{className:"unread-indicator","aria-hidden":"true"}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"item-header",children:[e.jsxs("div",{className:"header-left",children:[l&&e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"type-icon",title:v,"aria-label":`Type: ${v}`,children:I}),e.jsx("span",{className:`priority-indicator priority-${N.class}`,title:`Priority: ${N.text}`,"aria-label":`Priority: ${N.text}`,children:N.icon})]}),e.jsx("span",{className:"item-title",children:p})]}),e.jsx("div",{className:"header-right",children:e.jsx("span",{className:"item-time",title:new Date(b).toLocaleString(),children:r(b)})})]}),e.jsxs("div",{className:"item-body",children:[e.jsx("div",{className:"message-content",children:k}),P&&e.jsx("button",{className:"expand-toggle",onClick:T,"aria-label":u?"Show less":"Show more","aria-expanded":u,children:u?"Show less":"Show more"})]}),l&&e.jsx("div",{className:"notification-actions",children:e.jsxs("button",{className:"action-btn details-btn",onClick:h=>{h.stopPropagation();const w=`
Notification Details:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 ID: ${t}
📝 Title: ${p}
📄 Message: ${c}
📅 Created: ${new Date(b).toLocaleString()}
🔖 Type: ${v||"GENERAL"}
⚡ Priority: ${f||"MEDIUM"}
👁️ Status: ${y?"Read":"Unread"}
${a.relatedEntityType?`🔗 Related: ${a.relatedEntityType}`:""}
${a.relatedEntityId?`🆔 Entity ID: ${a.relatedEntityId}`:""}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                `;alert(w),console.log("Notification Details:",{notificationId:t,title:p,message:c,createdAt:b,type:v,priority:f,isRead:y,relatedEntityType:a.relatedEntityType,relatedEntityId:a.relatedEntityId})},title:"View notification details","aria-label":"View detailed information about this notification",children:[e.jsx("span",{className:"action-icon",children:"👁️"}),e.jsx("span",{className:"action-text",children:"Details"})]})})]}),l&&f&&(f==="HIGH"||f==="URGENT")&&e.jsx("div",{className:`priority-border priority-${N.class}`,"aria-hidden":"true"})]})};U.propTypes={notification:n.shape({notificationId:n.number.isRequired,title:n.string.isRequired,message:n.string.isRequired,isRead:n.bool.isRequired,createdAt:n.string.isRequired,priority:n.string,type:n.string}).isRequired,onMarkAsRead:n.func.isRequired,enhanced:n.bool};const L=({notifications:a,onMarkAsRead:x,onClose:l})=>{const[t,p]=m.useState("all"),[c,y]=m.useState("newest"),f=(()=>{let s=a;switch(t){case"unread":s=a.filter(r=>!r.isRead);break;case"high-priority":s=a.filter(r=>r.priority==="HIGH"||r.priority==="URGENT");break;case"today":{const r=new Date().toDateString();s=a.filter(j=>new Date(j.createdAt).toDateString()===r);break}default:s=a}return s.sort((r,j)=>{switch(c){case"oldest":return new Date(r.createdAt)-new Date(j.createdAt);case"priority":{const R={URGENT:4,HIGH:3,MEDIUM:2,LOW:1};return(R[j.priority]||2)-(R[r.priority]||2)}case"newest":default:return new Date(j.createdAt)-new Date(r.createdAt)}})})(),v=a.filter(s=>!s.isRead).length,u=a.filter(s=>(s.priority==="HIGH"||s.priority==="URGENT")&&!s.isRead).length;return e.jsxs("div",{className:"notification-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h3",{children:"Notifications"}),e.jsxs("div",{className:"notification-stats",children:[v>0&&e.jsxs("span",{className:"unread-badge",children:[v," unread"]}),u>0&&e.jsxs("span",{className:"priority-badge",children:[u," urgent"]})]})]}),e.jsx("div",{className:"panel-actions",children:l&&e.jsx("button",{className:"close-panel-btn",onClick:l,title:"Close panel","aria-label":"Close notification panel",children:"×"})})]}),e.jsx("div",{className:"panel-controls",children:e.jsxs("div",{className:"filter-controls",children:[e.jsxs("select",{value:t,onChange:s=>p(s.target.value),className:"filter-select","aria-label":"Filter notifications",children:[e.jsxs("option",{value:"all",children:["All (",a.length,")"]}),e.jsxs("option",{value:"unread",children:["Unread (",v,")"]}),e.jsxs("option",{value:"high-priority",children:["High Priority (",u,")"]}),e.jsx("option",{value:"today",children:"Today"})]}),e.jsxs("select",{value:c,onChange:s=>y(s.target.value),className:"sort-select","aria-label":"Sort notifications",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"priority",children:"By Priority"})]})]})}),e.jsx("div",{className:"panel-body",children:f.length>0?e.jsx("div",{className:"notifications-list",children:f.map(s=>e.jsx(U,{notification:s,onMarkAsRead:x,enhanced:!0},s.notificationId))}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:t==="unread"?"✅":"📨"}),e.jsx("p",{className:"empty-message",children:t==="unread"?"All caught up! No unread notifications.":t==="high-priority"?"No high priority notifications.":t==="today"?"No notifications today.":"No notifications found."})]})}),a.length>0&&e.jsx("div",{className:"panel-footer",children:e.jsx("div",{className:"footer-stats",children:e.jsxs("span",{className:"stats-text",children:["Showing ",f.length," of ",a.length]})})})]})};L.propTypes={notifications:n.arrayOf(n.shape({notificationId:n.number.isRequired,title:n.string.isRequired,message:n.string.isRequired,isRead:n.bool.isRequired,createdAt:n.string.isRequired,priority:n.string,type:n.string})).isRequired,onMarkAsRead:n.func.isRequired,onClose:n.func};const Q=({title:a,subtitle:x})=>{const{user:l}=G(),[t,p]=m.useState(new Date),[c,y]=m.useState(!1),[b,f]=m.useState(!1),[v,u]=m.useState(null),[s,r]=m.useState([]),[j,R]=m.useState(0),[S,T]=m.useState(!1),N=m.useCallback(()=>l&&(l.role==="Patient"||l?.role?.roleName==="Patient"),[l]),I=m.useCallback((i,d)=>{r(i),R(i.filter(g=>!g.isRead).length),d&&console.log("New notifications received:",i.filter(g=>!g.isRead).length)},[]);m.useEffect(()=>{const i=setInterval(()=>{p(new Date)},1e3);return()=>clearInterval(i)},[]),m.useEffect(()=>{(async()=>{if(N())try{const g=(await $.get("/patients/privacy-settings")).data?.isPrivate??!1;y(g),localStorage.setItem("privateMode",JSON.stringify(g))}catch(d){console.error("Failed to load privacy settings:",d),u("Failed to load privacy settings");const g=localStorage.getItem("privateMode");g&&y(JSON.parse(g))}})()},[N]),m.useEffect(()=>{if(!l)return;(async()=>{await M.getInitialNotifications()})();const d=M.subscribeToNotifications(I);return()=>{d()}},[l,I]),m.useEffect(()=>{l||(M.resetPollingState(),r([]),R(0))},[l]);const P=async()=>{if(!(!N()||b)){f(!0),u(null);try{const i=!c;y(i);const d=await $.post("/patients/privacy-settings",{isPrivate:i});if(!d.data?.success)throw new Error(d.data?.message||"Failed to update privacy settings");localStorage.setItem("privateMode",JSON.stringify(i))}catch(i){console.error("Failed to update privacy settings:",i),u("Failed to update privacy mode");const d=localStorage.getItem("privateMode");d&&y(JSON.parse(d))}finally{f(!1)}}},k=async i=>{const d=[...s],g=j;r(s.map(E=>E.notificationId===i?{...E,isRead:!0,status:"READ"}:E)),R(Math.max(0,j-1));try{const E=await M.markAsRead(i);E.success||(console.error("Failed to mark notification as read:",E.error),r(d),R(g))}catch(E){console.error("Exception in handleMarkAsRead:",E),r(d),R(g)}},h=()=>{const i={weekday:"short",year:"numeric",month:"short",day:"numeric"},d={hour:"2-digit",minute:"2-digit",hour12:!1},g=t.toLocaleDateString("en-GB",i),E=t.toLocaleTimeString("en-GB",d);return{date:g,time:E}},{date:w,time:o}=h();return e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"dashboard-header-content",children:[e.jsxs("div",{className:"dashboard-header-info",children:[e.jsxs("span",{className:"nav-logo",tabIndex:0,onClick:()=>window.location.pathname="/",onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(window.location.pathname="/")},children:[e.jsx("span",{className:"logo-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"28",height:"28",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})})}),e.jsx("span",{className:"logo-text",children:"HIV Medical System"})]}),e.jsxs("div",{className:"dashboard-header-titles",children:[e.jsx("h1",{className:"dashboard-title",children:a}),x&&e.jsx("p",{className:"dashboard-subtitle",children:x})]})]}),e.jsxs("div",{className:"dashboard-header-actions",children:[N()&&e.jsxs("button",{className:`privacy-toggle ${c?"active":""} ${b?"loading":""}`,onClick:P,disabled:b,title:v||`Turn ${c?"off":"on"} privacy mode`,role:"switch","aria-checked":c,type:"button",children:[e.jsx("span",{className:"icon",children:c?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"18"})]})}),c?"Anonymous":"Public"]}),e.jsxs("div",{className:"system-datetime",children:[e.jsx("div",{className:"date",children:w}),e.jsx("div",{className:"time",children:o})]}),e.jsx(W,{count:j,onClick:async()=>{console.log("Notification button clicked - marking all as read");try{const i=await M.markAllAsRead();i.success?(console.log("Successfully marked all notifications as read"),r(s.map(d=>({...d,isRead:!0,status:"READ"}))),R(0)):(console.error("Failed to mark all notifications as read:",i.error),u("Failed to mark notifications as read"))}catch(i){console.error("Exception marking all notifications as read:",i),u("Failed to mark notifications as read")}T(!S)}}),S&&e.jsx(L,{notifications:s,onMarkAsRead:k,onClose:()=>T(!1)}),e.jsx(_,{})]})]})})};export{Q as D,n as P};
